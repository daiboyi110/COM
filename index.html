<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Center of Mass (COM) Visualization</title>
    <link rel="stylesheet" href="styles.css">
    <!-- MediaPipe Pose Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <!-- SheetJS for Excel export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Center of Mass (COM) Visualization</h1>

        <div class="upload-section" id="uploadSection">
            <a href="README.md" target="_blank" class="upload-btn" style="background: #6c757d; text-decoration: none;">
                üìñ Read Me
            </a>
            <label class="upload-btn">
                üìπ Upload Video
                <input type="file" id="videoInput" accept="video/*" style="display: none;">
            </label>
            <label class="upload-btn">
                üñºÔ∏è Upload Image
                <input type="file" id="imageInput" accept="image/*" style="display: none;">
            </label>
        </div>

        <div id="imageSection" style="display: none;">
            <div class="video-layout-container">
                <!-- Left Sidebar -->
                <div class="video-left-controls">
                    <div class="side-control-group">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Analysis Mode</h3>
                        <label>
                            <input type="radio" name="analysisModeImage" value="2D" checked> 2D
                        </label>
                        <label>
                            <input type="radio" name="analysisModeImage" value="3D"> 3D
                        </label>
                    </div>

                    <div class="side-control-group">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Sex Selection</h3>
                        <label>
                            <input type="radio" name="sexImage" value="male" checked> Male
                        </label>
                        <label>
                            <input type="radio" name="sexImage" value="female"> Female
                        </label>
                    </div>

                    <div class="side-control-group">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Display Options</h3>
                        <label>
                            <input type="checkbox" id="showPoseImage" checked> Show Pose
                        </label>
                        <label>
                            <input type="checkbox" id="showCOMImage" checked> Show COM
                        </label>
                        <label>
                            <input type="checkbox" id="showLeftSideImage" checked> Show Left Side
                        </label>
                        <label>
                            <input type="checkbox" id="showRightSideImage" checked> Show Right Side
                        </label>
                        <label>
                            <input type="checkbox" id="showJointNumbersImage" checked> Names
                        </label>
                        <label>
                            <input type="checkbox" id="showCoordinatesImage"> Coordinates
                        </label>
                        <label>
                            <input type="checkbox" id="showCoordinateSystemImage"> Coordinate System
                        </label>
                        <label>
                            <input type="checkbox" id="fullSizeImage"> Full Size
                        </label>
                    </div>

                    <div class="side-control-group">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Font Size</h3>
                        <label style="flex-direction: row; align-items: center; gap: 8px;">
                            <input type="range" id="fontSizeSlider" min="12" max="60" value="28" step="2" style="flex: 1;">
                            <span id="fontSizeValue" style="min-width: 35px;">28</span>px
                        </label>
                    </div>

                    <div class="side-control-group">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Edit Mode</h3>
                        <label>
                            <input type="checkbox" id="editModeImage"> Edit Joint Positions
                        </label>
                        <label id="editCalibrationImageLabel">
                            <input type="checkbox" id="editModeCalibrationImage"> Edit Calibration Points
                        </label>
                        <label>
                            <input type="checkbox" id="drawLineModeImage"> Draw Line by Clicking Two Points
                        </label>
                        <label>
                            <input type="checkbox" id="drawAngleModeImage"> Draw Angle by Clicking Three Points
                        </label>
                        <button id="clearDrawingsImage" class="btn-clear" style="width: 100%; margin-top: 8px;">Clear Drawings</button>
                    </div>

                    <div class="side-control-group" id="calibrationScaleLabelImage">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Calibration Scale</h3>
                        <label style="flex-direction: row; align-items: center; gap: 8px;">
                            <input type="number" id="calibrationScaleImage" value="1.0" step="0.01" min="0.01" style="flex: 1;">
                            <span>m</span>
                        </label>
                    </div>
                </div>

                <!-- Center Column (Image) -->
                <div class="video-center-column">
                    <div class="legend">
                        <strong>Legend:</strong>
                        <span class="legend-item"><span class="legend-circle green"></span> Joints</span>
                        <span class="legend-item"><span class="legend-circle yellow"></span> Segment COM</span>
                        <span class="legend-item"><span class="legend-circle red"></span> Total-body COM</span>
                    </div>

                    <div class="video-wrapper">
                        <img id="imageDisplay">
                        <canvas id="imageCanvas"></canvas>
                    </div>
                </div>

                <!-- Right Sidebar -->
                <div class="video-right-controls" id="imageRightSidebar">
                    <div class="side-control-group">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Image Info</h3>
                        <div style="display: flex; flex-direction: column; gap: 8px; font-size: 14px;">
                            <span><strong>Image:</strong> <span id="imageInfo">Loading...</span></span>
                            <span><strong>Points:</strong> <span id="jointCountImage">0</span></span>
                        </div>
                    </div>

                    <div class="side-control-group">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Export</h3>
                        <button id="exportImageExcel" class="btn-export" style="width: 100%; margin-bottom: 8px;">üìó Export Excel</button>
                        <button id="exportImageScreenshot" class="btn-export" style="width: 100%;">üì∑ Export Image</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="videoSection" style="display: none;">
            <div class="video-layout-container">
                <!-- Left Sidebar -->
                <div class="video-left-controls">
                    <div class="side-control-group">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Analysis Mode</h3>
                        <label>
                            <input type="radio" name="analysisModeVideo" value="2D" checked> 2D
                        </label>
                        <label>
                            <input type="radio" name="analysisModeVideo" value="3D"> 3D
                        </label>
                    </div>

                    <div class="side-control-group">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Sex Selection</h3>
                        <label>
                            <input type="radio" name="sexVideo" value="male" checked> Male
                        </label>
                        <label>
                            <input type="radio" name="sexVideo" value="female"> Female
                        </label>
                    </div>

                    <div class="side-control-group">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Display Options</h3>
                        <label>
                            <input type="checkbox" id="showPose" checked> Show Pose
                        </label>
                        <label>
                            <input type="checkbox" id="showCOM" checked> Show COM
                        </label>
                        <label>
                            <input type="checkbox" id="showLeftSide" checked> Show Left Side
                        </label>
                        <label>
                            <input type="checkbox" id="showRightSide" checked> Show Right Side
                        </label>
                        <label>
                            <input type="checkbox" id="showJointNumbers" checked> Names
                        </label>
                        <label>
                            <input type="checkbox" id="showCoordinates"> Coordinates
                        </label>
                        <label>
                            <input type="checkbox" id="showCoordinateSystem"> Coordinate System
                        </label>
                        <label>
                            <input type="checkbox" id="fullSizeVideo"> Full Size
                        </label>
                    </div>

                    <div class="side-control-group">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Font Size</h3>
                        <label style="flex-direction: row; align-items: center; gap: 8px;">
                            <input type="range" id="fontSizeSliderVideo" min="12" max="60" value="28" step="2" style="flex: 1;">
                            <span id="fontSizeValueVideo" style="min-width: 35px;">28</span>px
                        </label>
                    </div>

                    <div class="side-control-group">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Edit Mode</h3>
                        <label>
                            <input type="checkbox" id="editModeVideo"> Edit Joint Positions
                        </label>
                        <label id="editCalibrationVideoLabel">
                            <input type="checkbox" id="editModeCalibrationVideo"> Edit Calibration Points
                        </label>
                        <label>
                            <input type="checkbox" id="drawLineModeVideo"> Draw Line by Clicking Two Points
                        </label>
                        <label>
                            <input type="checkbox" id="drawAngleModeVideo"> Draw Angle by Clicking Three Points
                        </label>
                        <button id="clearDrawingsVideo" class="btn-clear" style="width: 100%; margin-top: 8px;">Clear Drawings</button>
                    </div>

                    <div class="side-control-group" id="calibrationScaleLabelVideo">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Calibration Scale</h3>
                        <label style="flex-direction: row; align-items: center; gap: 8px;">
                            <input type="number" id="calibrationScaleVideo" value="1.0" step="0.01" min="0.01" style="flex: 1;">
                            <span>m</span>
                        </label>
                    </div>
                </div>

                <!-- Center Column (Video) -->
                <div class="video-center-column">
                    <div class="legend">
                        <strong>Legend:</strong>
                        <span class="legend-item"><span class="legend-circle green"></span> Joints</span>
                        <span class="legend-item"><span class="legend-circle yellow"></span> Segment COM</span>
                        <span class="legend-item"><span class="legend-circle red"></span> Total-body COM</span>
                    </div>

                    <div class="video-wrapper">
                        <video id="video" controls></video>
                        <canvas id="poseCanvas"></canvas>
                    </div>

                    <div class="controls">
                        <button id="playBtn" class="btn-primary">‚ñ∂ Play</button>
                        <button id="pauseBtn" class="btn-primary">‚è∏ Pause</button>
                        <button id="prevFrameBtn" class="btn-frame">‚èÆ Previous Frame</button>
                        <button id="nextFrameBtn" class="btn-frame">Next Frame ‚è≠</button>
                    </div>
                </div>

                <!-- Right Sidebar -->
                <div class="video-right-controls" id="videoRightSidebar">
                    <div class="side-control-group">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Video Info</h3>
                        <div style="display: flex; flex-direction: column; gap: 8px; font-size: 14px;">
                            <span><strong>Video:</strong> <span id="videoInfo">Loading...</span></span>
                            <span><strong>Time:</strong> <span id="timeDisplay">0:00</span></span>
                            <span><strong>Frame:</strong> <span id="frameNumber">0</span> / <span id="totalFrames">0</span></span>
                            <span><strong>Points:</strong> <span id="jointCountVideo">0</span></span>
                            <span><strong>Frames w/ Data:</strong> <span id="capturedFrames">0</span></span>
                            <span id="frameStep" class="frame-step" style="display: none;">Frame stepping...</span>
                        </div>
                    </div>

                    <div class="side-control-group">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">Export</h3>
                        <button id="exportVideoExcel" class="btn-export" style="width: 100%; margin-bottom: 8px;">üìó Export Excel</button>
                        <button id="exportFrameScreenshot" class="btn-export" style="width: 100%; margin-bottom: 8px;">üì∑ Export Frame</button>
                        <button id="exportVideoWithOverlay" class="btn-export" style="width: 100%; margin-bottom: 8px;">üé¨ Export Video</button>
                        <button id="clearDataBtn" class="btn-clear" style="width: 100%;">üóëÔ∏è Clear Data</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>Author:</strong> Boyi Dai</p>
            <p><strong>Contact:</strong> <a href="mailto:daiboyi@gmail.com">daiboyi@gmail.com</a></p>
            <p><strong>Last Updated:</strong> January 2026</p>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
